---

title: S3 Utilities


keywords: fastai
sidebar: home_sidebar

summary: "Provides utility functions for interacting with Amazon S3"
description: "Provides utility functions for interacting with Amazon S3"
nb_path: "nbs/s3_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/s3_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_valid_bucket" class="doc_header"><code>is_valid_bucket</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_valid_bucket</code>(<strong><code>bucket_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_bucket</span><span class="p">(</span><span class="s2">&quot;some.bucket.name&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_bucket</span><span class="p">(</span><span class="s2">&quot;somebucketname&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_bucket</span><span class="p">(</span><span class="s2">&quot;path/sep&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_bucket</span><span class="p">(</span><span class="s2">&quot;snake_case&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="s3_join" class="doc_header"><code>s3_join</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>s3_join</code>(<strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;windows\path\key&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;windows/path/key&quot;</span>
<span class="n">path_a</span> <span class="o">=</span> <span class="n">s3_join</span><span class="p">(</span><span class="s2">&quot;some/path&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts&quot;</span><span class="p">,</span> <span class="s2">&quot;runs.json&quot;</span><span class="p">)</span>
<span class="n">path_b</span> <span class="o">=</span> <span class="n">s3_join</span><span class="p">(</span><span class="s2">&quot;some/path/&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts&quot;</span><span class="p">,</span> <span class="s2">&quot;runs.json&quot;</span><span class="p">)</span>
<span class="n">path_c</span> <span class="o">=</span> <span class="n">s3_join</span><span class="p">(</span><span class="s2">&quot;some/path/&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts/&quot;</span><span class="p">,</span> <span class="s2">&quot;runs.json&quot;</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;some/path/artifacts/runs.json&quot;</span>
<span class="k">assert</span> <span class="n">path_a</span> <span class="o">==</span> <span class="n">path_b</span> <span class="o">==</span> <span class="n">path_c</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="objects_exist_in_dir" class="doc_header"><code>objects_exist_in_dir</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>objects_exist_in_dir</code>(<strong><code>s3_res</code></strong>, <strong><code>bucket_name</code></strong>, <strong><code>prefix</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bucket_name</span> <span class="o">=</span> <span class="s2">&quot;s3bawspprwe1chatbotunpub01&quot;</span>
<span class="n">missing_bucket</span> <span class="o">=</span> <span class="s2">&quot;nobuckethere&quot;</span>
<span class="n">invalid_bucket</span> <span class="o">=</span> <span class="s2">&quot;invalid_bucket_name&quot;</span>
<span class="n">experiment_dir</span> <span class="o">=</span> <span class="s2">&quot;discovery/experiments/s3_test&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">connect_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">read_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;max_attempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">s3_res</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="delete_dir" class="doc_header"><code>delete_dir</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>delete_dir</code>(<strong><code>s3_res</code></strong>, <strong><code>bucket_name</code></strong>, <strong><code>prefix</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bucket_name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment_dir</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">objects_exist_in_dir</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">&quot;/non&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">objects_exist_in_dir</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">experiment_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bucket_exists" class="doc_header"><code>bucket_exists</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bucket_exists</code>(<strong><code>s3_res</code></strong>, <strong><code>bucket_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="k">assert</span> <span class="n">bucket_exists</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bucket_exists</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">missing_bucket</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ConnectTimeoutError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">bucket_exists</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">invalid_bucket</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="list_s3_subdirs" class="doc_header"><code>list_s3_subdirs</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>list_s3_subdirs</code>(<strong><code>s3_res</code></strong>, <strong><code>bucket_name</code></strong>, <strong><code>prefix</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_s3_subdirs</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">experiment_dir</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_s3_subdirs</span><span class="p">(</span><span class="n">s3_res</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">&quot;blabla/somekey/nonsense&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="S3File" class="doc_header"><code>class</code> <code>S3File</code><a href="https://github.com/newdaytechnology/sciflow/tree/{branch}/sciflow/s3_utils.py#L94" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>S3File</code>(<strong><code>s3_object</code></strong>) :: <code>RawIOBase</code></p>
</blockquote>
<p>Base class for raw binary I/O.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

